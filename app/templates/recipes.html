<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ—Ü–µ–ø—Ç—ã</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">üç≥ RecipeApp</div>
            <div class="nav-links">
                <a href="/recipes">–í—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã</a>
                <a href="/recipes/popular">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</a>
                <a href="/logout" class="logout-btn">–í—ã–π—Ç–∏</a>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="filters-container">
            <div class="filter-group">
                <input type="number" id="maxTime" placeholder="–ú–∞–∫—Å. –≤—Ä–µ–º—è (–º–∏–Ω)" class="filter-input">
                <select id="cuisineFilter" class="filter-select">
                    <option value="">–í—Å–µ –∫—É—Ö–Ω–∏</option>
                    <option value="American">American</option>
                    <option value="British">British</option>
                    <option value="Canadian">Canadian</option>
                    <option value="Chinese">Chinese</option>
                    <option value="Croatian">Croatian</option>
                    <option value="Dutch">Dutch</option>
                    <option value="Egyptian">Egyptian</option>
                    <option value="Filipino">Filipino</option>
                    <option value="French">French</option>
                    <option value="Greek">Greek</option>
                    <option value="Indian">Indian</option>
                    <option value="Irish">Irish</option>
                    <option value="Italian">Italian</option>
                    <option value="Jamaican">Jamaican</option>
                    <option value="Japanese">Japanese</option>
                    <option value="Kenyan">Kenyan</option>
                    <option value="Malaysian">Malaysian</option>
                    <option value="Mexican">Mexican</option>
                    <option value="Moroccan">Moroccan</option>
                    <option value="Polish">Polish</option>
                    <option value="Portuguese">Portuguese</option>
                    <option value="Russian">Russian</option>
                    <option value="Spanish">Spanish</option>
                    <option value="Thai">Thai</option>
                    <option value="Tunisian">Tunisian</option>
                    <option value="Turkish">Turkish</option>
                    <option value="Ukrainian">Ukrainian</option>
                    <option value="Uruguayan">Uruguayan</option>
                    <option value="Vietnamese">Vietnamese</option>
                </select>
                <button class="filter-btn" onclick="applyFilters()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã -->
        <h2 class="section-title">–í—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã</h2>
        <div class="recipe-grid" id="recipeList"></div>

        <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã -->
        <h2 class="section-title">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ —Å–µ–π—á–∞—Å</h2>
        <div class="popular-scroller" id="popularRecipes"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            await loadRecipes('/recipes');
            await loadPopularRecipes();
        });

        async function loadRecipes(url) {
            try {
                const response = await fetch(url);
                const recipes = await response.json();
                renderRecipes(recipes, 'recipeList');
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤:', err);
            }
        }

        async function loadPopularRecipes() {
            try {
                const response = await fetch('/recipes/popular?limit=5');
                const recipes = await response.json();
                renderRecipes(recipes, 'popularRecipes', true);
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤:', err);
            }
        }

        function renderRecipes(recipes, containerId, isHorizontal = false) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            recipes.forEach(recipe => {
                const recipeCard = `
                    <div class="recipe-card ${isHorizontal ? 'horizontal' : ''}">
                        <img src="${recipe.image_url || '/static/default-recipe.jpg'}"
                             alt="${recipe.title}"
                             class="recipe-image">
                        <div class="recipe-content">
                            <h3 class="recipe-title">${recipe.title}</h3>
                            <div class="recipe-meta">
                                <span class="time">‚è± ${recipe.cooking_time} –º–∏–Ω</span>
                                <span class="rating">‚≠ê ${recipe.average_rating?.toFixed(1) || '–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫'}</span>
                            </div>
                            <a href="/recipe/${recipe.id}" class="details-link">–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ—Ü–µ–ø—Ç ‚Üí</a>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', recipeCard);
            });
        }

        function applyFilters() {
            const maxTime = document.getElementById('maxTime').value;
            const cuisine = document.getElementById('cuisineFilter').value;
            let url = '/recipes';

            if (maxTime || cuisine) {
                url = `/recipes/time/${maxTime}?cuisine=${cuisine}`;
            }

            loadRecipes(url);
        }
    </script>
</body>
</html>